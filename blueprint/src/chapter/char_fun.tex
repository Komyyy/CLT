\chapter{The characteristic function}

\section{Definition and first properties}

\begin{definition}[Characteristic function]\label{def:charFun}
\lean{ProbabilityTheory.charFun} \leanok
Let $\mu$ be a measure on a real inner product space $E$. The characteristic function of $\mu$, denoted by $\hat{\mu}$, is the function $E \to \mathbb{C}$ defined by
\begin{align*}
\hat{\mu}(t) = \int_x e^{i \langle t, x \rangle} d\mu(x) \: .
\end{align*}
The characteristic function of a random variable $X$ is defined as the characteristic function of $\mathcal L(X)$.
\end{definition}

\begin{lemma}\label{lem:charFun_bounded}
\lean{ProbabilityTheory.norm_charFun_le_one} \leanok
\uses{def:charFun}
For all $t$, $\Vert\hat{\mu}(t)\Vert \le 1$.
\end{lemma}

\begin{lemma}\label{lem:charFun_continuous}
\uses{def:charFun}
The characteristic function is a continuous function.
\end{lemma}

\begin{lemma}\label{lem:charFun_neg}
\lean{ProbabilityTheory.charFun_neg} \leanok
\uses{def:charFun}
$\hat{\mu}(-t) = \overline{\hat{\mu}(t)}$.
\end{lemma}

\begin{lemma}\label{lem:charFun_smul}
\uses{def:charFun}
For $a \in \mathbb{R}$, the characteristic function of $a X$ is $t \mapsto \phi_X(at)$.
\end{lemma}

\begin{lemma}\label{lem:charFun_add_of_indep}
\uses{def:charFun}
If two random variables $X, Y : \Omega \to S$ are independent, then $X+Y$ has characteristic function $\phi_{X+Y} = \phi_X \phi_Y$. 
\end{lemma}

\begin{lemma}\label{lem:charFun_bound}
\uses{def:charFun}
For $\mu$ a probability measure on $\mathbb{R}$ and $r > 0$,
\begin{align*}
\mu \left\{x \mid |x| \ge r\right\}
&\le \frac{r}{2} \int_{-2/r}^{2/r} (1 - \hat{\mu}(t))dt
\: , \\
\mu [-r, r]
&\le 2 r \int_{-1/r}^{1/r} |\hat{\mu}(t)| dt
\: .
\end{align*}
\end{lemma}

\begin{proof}
TODO
\end{proof}

\begin{lemma}\label{lem:abs_sub_charFun}
\uses{def:charFun}
Let $X$ be a random variable with law $\mu$. Then for any $s, t$,
\begin{align*}
\vert \hat{\mu}(s) - \hat{\mu}(t) \vert
\le 2 \mathbb{E}\left[ \left\vert (s - t) X\right\vert \wedge 1\right]
\: .
\end{align*}
\end{lemma}

\begin{proof}
\begin{align*}
\vert \hat{\mu}(s) - \hat{\mu}(t) \vert
&= \vert \mathbb{E}\left[e^{isX} - e^{itX}\right] \vert
\\
&\le \mathbb{E}\left[\vert e^{isX} - e^{itX} \vert\right]
\\
&= \mathbb{E}\left[\vert 1 - e^{i(t - s)X} \vert\right]
\le 2 \mathbb{E}\left[ \left\vert (s - t) X\right\vert \wedge 1\right]
\: .
\end{align*}
\end{proof}

\section{Convergence of characteristic functions and weak convergence of measures}


\begin{definition}\label{def:tight}
A set $S$ of measures on $\Omega$ is tight if for all $\varepsilon > 0$ there exists a compact set $K$ such that for all $\mu \in S$, $\mu(\Omega \setminus K) \le \varepsilon$.
\end{definition}

\begin{lemma}\label{lem:tight_iff_charFun_equiContinuous}
A family of measures $(\mu_a)$ on a finite dimensional inner product space is tight iff the family of functions $\hat{\mu}_a$ is equi-continuous at 0.
\end{lemma}

\begin{proof}\uses{lem:charFun_bound, lem:abs_sub_charFun}
TODO
\end{proof}

\begin{lemma}\label{lem:tight_of_tendsto_charFun}
Let $(\mu_n)_{n \in \mathbb{N}}$ be measures with characteristic functions $(\hat{\mu}_n)$. If $\hat{\mu}_n$ converges pointwise to a function $f$ which is continuous at 0, then $(\mu_n)$ is tight.
\end{lemma}

\begin{proof}\uses{lem:tight_iff_charFun_equiContinuous}
TODO
\end{proof}

\begin{definition}\label{def:separates_points}
\lean{Set.SeparatesPoints} \leanok
A set $\mathcal F$ of functions $E \to F$ separates points in $E$ if for all $x, y \in E$ with $x \ne y$, there exists $f \in \mathcal F$ with $f(x) \ne f(y)$.
\end{definition}

\begin{definition}\label{def:separating}
A set $\mathcal F$ of functions $E \to F$ is separating in $\mathcal P(E)$ if for all probability measures $\mu, \nu$ on $E$ with $\mu \ne \nu$, there exists $f \in \mathcal F$ with $\mu[f] \ne \nu[f]$.
\end{definition}

TODO: this is a special case of a definition about duality pairings. Two types $E$, $F$ and a bilinear function $B : E \times F \to \mathbb{k}$ form a pairing (in the def above $\mathcal P(E)$, $C_b(E, \mathbb{C})$ and the integral). A set $\mathcal E$ of $E$ is separating if for all $f, f' \in F$ with $f \ne f'$, there exists $x \in \mathcal E$ with $B(x, f) \ne B(x, f')$. 

\begin{lemma}\label{lem:bounded_continuous_separating}
\uses{def:separating}
In a Borel space $E$, the set $C_b(E, \mathbb{C})$ is separating in $\mathcal P(E)$.
\end{lemma}

\begin{proof}
The Mathlib lemma \texttt{MeasureTheory.FiniteMeasure.ext\_of\_forall\_lintegral\_eq} shows that $C_b(E, \mathbb{R}_+)$ is separating. Since $C_b(E, \mathbb{R}_{+}) \subseteq C_b(E, \mathbb{C})$, the larger set is also separating.
\end{proof}

\begin{lemma}\label{lem:innerRegular_ne_iff_compact}
For any two regular measures $\mu, \nu$ on $E$ with $\mu \ne \nu$, there exists a compact set $K$ with $\mu(K) \ne \nu(K)$.
\end{lemma}

\begin{proof}
By definition of \texttt{InnerRegularCompactLTTop}.
\end{proof}

\begin{theorem}[Subalgebras separating points]\label{thm:separating_starSubalgebra}
\uses{def:separates_points}
Let $E$ be a complete separable pseudo-metric space. Let $\mathcal M \subseteq C_b(E, \mathbb{C})$ be a star-subalgebra that separates points. Then $\mathcal M$ is separating in $\mathcal P(E)$.
\end{theorem}

\begin{proof}\uses{lem:bounded_continuous_separating, lem:innerRegular_ne_iff_compact}
Let $\mu$ and $\nu$ be two probability measures with same characteristic function, and such that $\mu \ne \nu$.
These two measures are inner regular, hence there exists $K$ compact with $\mu(K) \ne \nu(K)$.
We consider the restrictions $\mu_K$ and $\nu_K$ of the measures to that compact set.

On $K$, the Stone-Weierstrass theorem \texttt{ContinuousMap.starSubalgebra\_topologicalClosure\_eq\_top\_of\_separatesPoints} gives that a subalgebra that separates points is dense.

TODO
\end{proof}

\begin{lemma}\label{lem:exp_character}
$x \mapsto (t \mapsto \exp(i \langle t, x \rangle))$ is a monoid homomorphism from $(E,+)$ to $C_b(E, \mathbb{C})$, the bounded continuous functions from $E$ to $\mathbb{C}$.
\end{lemma}

\begin{lemma}\label{lem:starSubalgebra_expPoly}
The functions of the form $x \mapsto \sum_{k=1}^n a_k e^{i\langle t_k, x\rangle}$ for $n \in \mathbb{N}$, $a_1, \ldots, a_n \in \mathbb{R}$ and $t_1, \ldots, t_n \in E$ are a star-subalgebra of $C_b(E, \mathbb{C})$. 
\end{lemma}

\begin{proof}\uses{lem:exp_character}
The monoid homomorphism can be lifted to a homomorphism of algebras from \texttt{AddMonoidAlgebra ‚Ñù E} to $C_b(E, \mathbb{C})$ using \texttt{AddMonoidAlgebra.lift}. $\mathcal M$ is the range of this homomorphism. The ``star'' part can be checked easily.
\end{proof}

Let $\mathcal M$ be the set of these functions, which we call exponential polynomials.

\begin{lemma}\label{lem:separating_expPoly}
\uses{lem:starSubalgebra_expPoly}
The star-subalgebra $\mathcal M$ separates points.
\end{lemma}

\begin{proof}
TODO
\end{proof}

%\begin{lemma}\label{lem:dirac_dense}
%On a suitable (?) compact space, finite linear combinations of Dirac measures are dense in the probability measures for the weak convergence of measures.
%\end{lemma}

\begin{lemma}\label{lem:ext_charFun}
Two probability measure on a TODO space are equal iff they have the same characteristic function.
\end{lemma}
\begin{proof}

\end{proof}

\begin{theorem}[Convergence of characteristic functions and weak convergence of measures]\label{thm:charFun_tendsto_iff_measure_tendsto}
Let $\mu, \mu_1, \mu_2, \ldots$ be probability measures with characteristic functions $\hat{\mu}, \hat{\mu}_1, \hat{\mu}_2, \ldots$. Then $\mu_n \xrightarrow{w} \mu$ iff for all $t$, $\hat{\mu}_n(t) \to \hat{\mu}(t)$.
\end{theorem}

\begin{proof}\uses{def:cvg_distribution, lem:ext_charFun}
For all $t$, $x \mapsto e^{i \langle t, x \rangle}$ is a bounded continuous function. Hence by the definition of convergence in distribution, $\mu_n \xrightarrow{w} \mu \implies \hat{\mu}_n(t) \to \hat{\mu}(t)$ for all $t$.

TODO reverse direction.
\end{proof}